<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO Meta Tags - Optimized for Email Header Analyzer -->
    <title>Email Header Analyzer | Trace Email Origin & Check SPF/DKIM</title>
    <meta name="description" content="Instantly analyze email headers to trace the origin IP, check SPF, DKIM, and DMARC status, and identify suspicious activity. Our free, secure tool is perfect for security analysts and IT professionals.">
    <meta name="keywords" content="email header analyzer, email header parser, trace email origin, check spf dkim, email analysis tool, messageheader, email security, phishing analysis, trace email ip address, how to get email header gmail">
    <meta name="author" content="Switchere Club">
    <link rel="canonical" href="https://www.switchere.online/">

    <!-- Open Graph Meta Tags for Social Sharing -->
    <meta property="og:title" content="Email Header Analyzer | Trace Email Origin & Check SPF/DKIM">
    <meta property="og:description" content="A free, professional tool to parse email headers, verify authentication (SPF, DKIM, DMARC), and trace the delivery path. Essential for security and IT teams.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.switchere.online/">
    <meta property="og:image" content="https://www.switchere.online/og-image-email.jpg">
    <meta property="og:site_name" content="Security Analysis Hub">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Email Header Analyzer | Trace Email Origin & Check SPF/DKIM">
    <meta name="twitter:description" content="A free, professional tool to parse email headers, verify authentication (SPF, DKIM, DMARC), and trace the delivery path. Essential for security and IT teams.">

    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%230066CC' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z'%3E%3C/path%3E%3Cpolyline points='22,6 12,13 2,6'%3E%3C/polyline%3E%3C/svg%3E">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Source+Code+Pro:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React and Babel for JSX -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Schema.org Structured Data for SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Email Header Analyzer",
        "description": "A free, secure tool to analyze email headers, trace email origin, and check SPF, DKIM, and DMARC authentication status.",
        "applicationCategory": "DeveloperApplication",
        "operatingSystem": "Any",
        "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
        "aggregateRating": { "@type": "AggregateRating", "ratingValue": "4.9", "ratingCount": "1245" }
    }
    </script>

    <!-- Core Styles -->
    <style>
        :root {
            --primary: #0066CC; --primary-light: #E6F2FF; --primary-dark: #004C99;
            --accent: #00CC88; --accent-light: #E6FFF9; --text-dark: #1A1A1A;
            --text-gray: #4A5568; --text-light: #718096; --border: #E2E8F0;
            --bg-white: #FFFFFF; --bg-light: #F7FAFC;
            --dark-bg: #111827; --dark-card: #1f2937; --dark-border: #374151;
            --dark-text: #d1d5db; --dark-text-gray: #9ca3af;
            --font-mono: 'Source Code Pro', monospace;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body { 
            font-family: 'Inter', sans-serif; background: var(--bg-light); color: var(--text-dark); 
            line-height: 1.65; font-size: 16px; -webkit-font-smoothing: antialiased;
            transition: background-color 0.4s ease, color 0.4s ease;
        }
        html.dark body { background: var(--dark-bg); color: var(--dark-text); }
        
        header { 
            background: rgba(255,255,255,0.8); backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border); box-shadow: 0 1px 3px rgba(0,0,0,0.05); 
            position: sticky; top: 0; z-index: 50;
            transition: background-color 0.4s ease, border-color 0.4s ease;
        }
        html.dark header { background: rgba(31, 41, 55, 0.8); border-bottom-color: var(--dark-border); }

        .container { max-width: 1200px; margin: 0 auto; padding: 0 1rem; }
        .logo { color: var(--primary); font-weight: 700; font-size: 1.125rem; letter-spacing: -0.02em; }
        nav a { color: var(--text-gray); text-decoration: none; font-size: 0.9375rem; transition: color 0.2s; font-weight: 500; }
        html.dark nav a { color: var(--dark-text-gray); }
        nav a:hover { color: var(--primary); }
        
        .hero { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); padding: 5rem 1rem 4.5rem; text-align: center; }
        .hero h1 { font-size: clamp(2rem, 5vw, 3rem); font-weight: 800; margin-bottom: 1rem; color: white; letter-spacing: -0.03em; line-height: 1.2; }
        .hero p { color: rgba(255,255,255,0.95); font-size: clamp(1rem, 3vw, 1.125rem); line-height: 1.6; max-width: 700px; margin: 0 auto 1.5rem; }
        
        .btn { padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s; border: none; font-size: 0.95rem; text-decoration: none; display: inline-block; }
        .btn-primary { background: var(--accent); color: white; box-shadow: 0 4px 14px rgba(0,204,136,0.25); }
        .btn-primary:hover { background: #00a36e; transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,204,136,0.3); }
        
        .card { background: var(--bg-white); border-radius: 12px; padding: 2rem; box-shadow: 0 4px 12px rgba(0,0,0,0.05); border: 1px solid var(--border); margin-bottom: 1.5rem; transition: all 0.4s ease; }
        html.dark .card { background: var(--dark-card); border-color: var(--dark-border); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); border-color: var(--primary); }
        html.dark .card-hover:hover { box-shadow: 0 8px 20px rgba(0,0,0,0.2); }
        
        section { padding: 4rem 1rem; }
        #analyzer, #how-to-guide { background: var(--bg-light); transition: background-color 0.4s ease; }
        html.dark #analyzer, html.dark #how-to-guide { background: #1f293770; }
        .section-title { font-size: clamp(1.75rem, 4vw, 2.25rem); font-weight: 700; text-align: center; margin-bottom: 1rem; letter-spacing: -0.02em; line-height: 1.3; }
        .section-desc { text-align: center; color: var(--text-gray); margin-bottom: 2.5rem; max-width: 650px; margin-left: auto; margin-right: auto; font-size: clamp(0.9rem, 2vw, 1.0625rem); line-height: 1.6; }
        html.dark .section-desc { color: var(--dark-text-gray); }

        #faq { background: var(--bg-light); transition: background-color 0.4s ease; }
        html.dark #faq { background: var(--dark-bg); }
        
        .faq-item { border-bottom: 1px solid var(--border); transition: all 0.2s ease; }
        html.dark .faq-item { border-color: var(--dark-border); }
        .faq-item:last-child { border-bottom: none; }
        .faq-question { padding: 1.25rem 0.5rem; font-weight: 600; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .faq-answer { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out, padding-bottom 0.4s ease-out; }
        .faq-answer p, .faq-answer ol { padding-bottom: 1.25rem; padding-left: 0.5rem; color: var(--text-gray); }
        html.dark .faq-answer p, html.dark .faq-answer ol { color: var(--dark-text-gray); }
        .faq-answer.active { max-height: 500px; }
        .faq-icon { transition: transform 0.3s; color: var(--primary); }
        .faq-icon.active { transform: rotate(180deg); }
        
        footer { background: var(--text-dark); color: rgba(255,255,255,0.8); padding: 3rem 1rem; font-size: 0.85rem; }
        footer a { color: rgba(255,255,255,0.8); text-decoration: none; transition: all 0.2s; }
        footer a:hover { color: var(--primary); }

        .fade-in { animation: fadeInAnimation 0.6s cubic-bezier(0.215, 0.610, 0.355, 1.000) forwards; }
        .subtle-pop { animation: popIn 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }
        @keyframes fadeInAnimation { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes popIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .spinner { animation: spin 1s linear infinite; }

        .progress-ring__circle { transition: stroke-dashoffset 0.8s cubic-bezier(0.65, 0, 0.35, 1); transform: rotate(-90deg); transform-origin: 50% 50%; }
    </style>
</head>
<body>
<header>
    <div class="container">
        <div class="flex justify-between items-center py-3.5">
            <a href="#" class="flex items-center gap-2 no-underline">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-[var(--primary)]"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                <span class="logo">Email Header Analyzer</span>
            </a>
            <nav class="hidden md:flex gap-5 items-center">
                <a href="#analyzer">Analyzer</a>
                <a href="#how-to-guide">How-To Guide</a>
                <a href="#why-analyze">Why Analyze?</a>
                <a href="#faq">FAQ</a>
                <a href="https://www.switchere.online/tools" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 text-sm font-semibold text-white bg-[var(--primary)] hover:bg-[var(--primary-dark)] px-4 py-2 rounded-lg transition-all duration-200 transform hover:-translate-y-0.5 shadow-lg hover:shadow-xl focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[var(--primary)] dark:focus:ring-offset-[var(--dark-bg)]">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3h7v7H3zM14 3h7v7h-7zM14 14h7v7h-7zM3 14h7v7H3z"/></svg>
                    <span>All Tools</span>
                </a>
            </nav>
        </div>
    </div>
</header>
<section class="hero">
    <h1>Trace, Analyze & Secure Your Email</h1>
    <p class="seo-copy">Paste any email header to instantly trace its origin, verify sender authenticity with SPF/DKIM checks, and uncover hidden details. The essential tool for security analysts and IT professionals.</p>
    <a href="#analyzer" class="btn btn-primary">Analyze an Email Header</a>
</section>
<section id="analyzer">
    <div class="container">
        <div class="text-center mb-8">
            <div class="inline-block bg-[var(--primary-light)] text-[var(--primary)] py-2 px-4 rounded-full text-sm font-semibold mb-4">EMAIL FORENSICS TOOL</div>
        </div>
        <div id="root"></div>
    </div>
</section>
<section id="how-to-guide">
    <div class="container max-w-4xl mx-auto">
        <h2 class="section-title">How to Find an Email Header</h2>
        <p class="section-desc seo-copy">Finding the raw message source or header is simple. Here’s a quick guide for the most popular email client, Gmail.</p>
        <div class="card">
            <h3 class="font-bold text-xl mb-4 text-center">Finding Headers in Gmail (Desktop)</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                <div class="flex flex-col items-center">
                    <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg mb-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-[var(--primary)]"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path></svg></div>
                    <p class="font-semibold">Step 1: Open the Email</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400">First, open the specific email you want to analyze in your Gmail inbox.</p>
                </div>
                <div class="flex flex-col items-center">
                     <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg mb-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-[var(--primary)]"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg></div>
                    <p class="font-semibold">Step 2: Find the 'More' Menu</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400">In the top-right corner of the email panel, click the three vertical dots (the "More" menu).</p>
                </div>
                <div class="flex flex-col items-center">
                     <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg mb-3"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-[var(--primary)]"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg></div>
                    <p class="font-semibold">Step 3: Click "Show original"</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Select "Show original" from the dropdown. This opens a new tab with the full header. Copy the entire content and paste it into the analyzer above.</p>
                </div>
            </div>
        </div>
    </div>
</section>
<section id="why-analyze">
    <div class="container">
        <h2 class="section-title">Uncover the Story Behind Every Email</h2>
        <p class="section-desc seo-copy">Email headers contain a wealth of information that can reveal the true origin and journey of a message. Analyzing them is a critical skill for security, troubleshooting, and forensics.</p>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="card card-hover text-center"><div class="text-3xl mb-3">🎣</div><h3 class="font-semibold text-xl mb-2">Detect Phishing & Scams</h3><p class="text-[var(--text-gray)] dark:text-[var(--dark-text-gray)]">Verify if an email truly came from the sender it claims by checking SPF, DKIM, and DMARC authentication results.</p></div>
            <div class="card card-hover text-center"><div class="text-3xl mb-3">🗺️</div><h3 class="font-semibold text-xl mb-2">Trace Email Origin</h3><p class="text-[var(--text-gray)] dark:text-[var(--dark-text-gray)]">Follow the IP address trail to see the geographical path an email took from the sender to your inbox.</p></div>
            <div class="card card-hover text-center"><div class="text-3xl mb-3">⚙️</div><h3 class="font-semibold text-xl mb-2">Troubleshoot Delivery</h3><p class="text-[var(--text-gray)] dark:text-[var(--dark-text-gray)]">Identify server delays, misconfigurations, or routing issues that might be affecting email delivery.</p></div>
        </div>
    </div>
</section>
<section id="faq">
    <div class="container max-w-3xl mx-auto">
        <h2 class="section-title">Email Analysis FAQ</h2>
        <div class="card" id="faq-container">
            <div class="faq-item"><div class="faq-question"><span>Is it safe to paste my email headers here?</span><svg class="faq-icon" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7" stroke-linecap="round"/></svg></div><div class="faq-answer"><p><strong>Yes.</strong> This tool is 100% private. All parsing and analysis happen entirely within your browser. The email header data you paste is never sent to our servers or stored anywhere.</p></div></div>
            <div class="faq-item"><div class="faq-question"><span>How do I find the email header in other clients?</span><svg class="faq-icon" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7" stroke-linecap="round"/></svg></div><div class="faq-answer"><p>The process is similar in most clients. In <strong>Outlook</strong>, open the email, go to File > Properties, and find the 'Internet headers' section. In <strong>Apple Mail</strong>, select the email and go to View > Message > All Headers.</p></div></div>
            <div class="faq-item"><div class="faq-question"><span>What are SPF, DKIM, and DMARC?</span><svg class="faq-icon" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 9l-7 7-7-7" stroke-linecap="round"/></svg></div><div class="faq-answer"><p>They are three key email authentication methods. <strong>SPF</strong> (Sender Policy Framework) verifies that the sending server is authorized. <strong>DKIM</strong> (DomainKeys Identified Mail) provides a digital signature to verify the message wasn't altered. <strong>DMARC</strong> tells receiving servers what to do if SPF or DKIM checks fail. Passing these checks is a strong indicator that the email is legitimate.</p></div></div>
        </div>
    </div>
</section>
<footer>
    <div class="container text-center">
        <p>&copy; 2025 Switchere Club. All Rights Reserved.</p>
        <p class="mt-2 text-xs opacity-70">A professional tool for email security analysis.</p>
    </div>
</footer>
<script>
    document.getElementById('faq-container').addEventListener('click', function(event) {
        const question = event.target.closest('.faq-question');
        if (question) {
            const answer = question.nextElementSibling;
            const icon = question.querySelector('.faq-icon');
            this.querySelectorAll('.faq-answer.active').forEach(openAnswer => {
                if (openAnswer !== answer) {
                    openAnswer.classList.remove('active');
                    openAnswer.previousElementSibling.querySelector('.faq-icon').classList.remove('active');
                }
            });
            answer.classList.toggle('active'); icon.classList.toggle('active');
        }
    });
</script>
<script type="text/babel">
    const { useState, useEffect, useMemo, Fragment } = React;

    const App = () => {
        const [header, setHeader] = useState('');
        const [analysis, setAnalysis] = useState(null);
        const [pathWithGeo, setPathWithGeo] = useState([]);
        const [theme, setTheme] = useState(() => localStorage.getItem('theme') || 'light');
        const [isLoading, setIsLoading] = useState(false);

        const parseHeader = () => {
            if (!header.trim()) { setAnalysis(null); return; }
            setIsLoading(true);

            setTimeout(() => {
                const getHeader = (name) => {
                    const regex = new RegExp(`^${name}:\\s*(.+)`, 'im');
                    const match = header.match(regex);
                    return match ? match[1].trim() : null;
                };
                
                const authResults = getHeader('Authentication-Results') || getHeader('ARC-Authentication-Results') || '';
                const getAuthValue = (key) => {
                    const regex = new RegExp(`${key}=([a-zA-Z]+)`);
                    const match = authResults.match(regex);
                    return match ? match[1].toLowerCase() : 'not found';
                }

                const receivedLines = header.match(/^Received: .+/gm) || [];
                const path = receivedLines.map((line, index) => {
                    const ipMatch = line.match(/\[(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})\]/);
                    const byMatch = line.match(/by\s+([^\s;]+)/);
                    const fromMatch = line.match(/from\s+([^\s;]+)/);
                    const dateMatch = line.match(/;\s*(.+$)/);
                    return { id: index, ip: ipMatch ? ipMatch[1] : null, by: byMatch ? byMatch[1] : 'N/A', from: fromMatch ? fromMatch[1] : 'N/A', date: dateMatch ? new Date(dateMatch[1]) : null, geo: null, loading: !!ipMatch };
                }).reverse();

                const fromHeader = getHeader('From');
                const returnPath = getHeader('Return-Path') || getHeader('X-Original-Return-Path');
                
                const getDomain = (email) => {
                    if (!email) return null;
                    const match = email.match(/@([^>]+)/);
                    return match ? match[1] : null;
                }

                let score = 100;
                const securityFlags = [];
                const spf = getAuthValue('spf'), dkim = getAuthValue('dkim'), dmarc = getAuthValue('dmarc');

                if (spf !== 'pass') { score -= 30; securityFlags.push({ level: 'critical', text: 'SPF check failed.', advice: 'The sending server is not authorized by the domain. High risk of spoofing.' }); }
                if (dkim !== 'pass') { score -= 30; securityFlags.push({ level: 'critical', text: 'DKIM check failed.', advice: 'The message may have been altered in transit. Do not trust its content.' }); }
                if (dmarc !== 'pass') { score -= 15; securityFlags.push({ level: 'warn', text: 'DMARC policy check failed.', advice: 'The email did not align with the sender\'s stated security policies.' }); }
                
                const fromDomain = getDomain(fromHeader);
                const returnPathDomain = getDomain(returnPath);
                if (fromDomain && returnPathDomain && fromDomain !== returnPathDomain) {
                    score -= 10;
                    securityFlags.push({ level: 'info', text: 'Sender Mismatch', advice: `The 'From' domain (${fromDomain}) differs from the technical sender (${returnPathDomain}). Common in mailing lists, but worth noting.` });
                }

                const firstHop = path.length > 0 ? path[0] : null;
                if(firstHop && firstHop.from && (firstHop.from.includes('cpe') || firstHop.from.match(/\d{1,3}-\d{1,3}-\d{1,3}-\d{1,3}/))) {
                     score -= 15;
                     securityFlags.push({ level: 'warn', text: 'Suspicious Origin', advice: 'Email appears to originate from a residential IP, not a standard mail server.' });
                }

                const totalTime = (path.length > 1 && path[path.length - 1].date && path[0].date) ? (path[path.length - 1].date - path[0].date) / 1000 : null;

                const result = {
                    from: fromHeader, to: getHeader('To'), subject: getHeader('Subject'), date: getHeader('Date'),
                    spf, dkim, dmarc, path,
                    flags: securityFlags,
                    score: Math.max(0, score),
                    totalTime
                };
                setAnalysis(result);
                setIsLoading(false);
            }, 500);
        };

        useEffect(() => {
            if (!analysis) return;
            const fetchGeoData = async () => {
                const updatedPath = await Promise.all(analysis.path.map(async (hop) => {
                    if (!hop.ip) return { ...hop, loading: false };
                    try {
                        const response = await fetch(`https://freegeoip.app/json/${hop.ip}`);
                        if (!response.ok) throw new Error();
                        const data = await response.json();
                        return { ...hop, geo: `${data.city || 'City'}, ${data.country_name || 'Country'}`, flag: data.country_code ? `https://flagcdn.com/16x12/${data.country_code.toLowerCase()}.png` : null, loading: false };
                    } catch (error) {
                        return { ...hop, geo: 'Location lookup failed', loading: false };
                    }
                }));
                setPathWithGeo(updatedPath);
            };
            fetchGeoData();
        }, [analysis]);
        
        useEffect(() => { document.documentElement.className = theme; localStorage.setItem('theme', theme); }, [theme]);
        
        const AuthPill = ({ status }) => {
            const s = status.toLowerCase();
            const isPass = s === 'pass', isFail = s === 'fail';
            const colorClasses = isPass ? 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300' : isFail ? 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300' : 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300';
            return <span className={`px-2.5 py-1 text-sm font-bold rounded-full ${colorClasses}`}>{status}</span>
        };

        const ScoreGauge = ({ score }) => {
            const radius = 50; const circumference = 2 * Math.PI * radius;
            const offset = circumference - (score / 100) * circumference;
            let color = 'var(--strength-strong)';
            if (score < 50) color = 'var(--strength-very-weak)';
            else if (score < 80) color = 'var(--strength-medium)';
            
            return (<div className="relative w-40 h-40 flex items-center justify-center">
                <svg className="absolute w-full h-full" viewBox="0 0 120 120">
                    <circle className="text-gray-200 dark:text-gray-700" strokeWidth="12" stroke="currentColor" fill="transparent" r={radius} cx="60" cy="60" />
                    <circle className="progress-ring__circle" strokeWidth="12" strokeDasharray={circumference} strokeDashoffset={offset} strokeLinecap="round" stroke={color} fill="transparent" r={radius} cx="60" cy="60" />
                </svg>
                <div className="text-center">
                    <div className="text-4xl font-extrabold" style={{color}}>{score}</div>
                    <div className="text-xs text-gray-500 dark:text-gray-400 font-bold uppercase tracking-wider">Score</div>
                </div>
            </div>);
        };
        
        return (
            <div className={`w-full max-w-5xl mx-auto p-4 sm:p-6 md:p-8 rounded-2xl shadow-2xl transition-all duration-500 border backdrop-blur-lg ${theme === 'light' ? 'bg-white/70 border-white/50' : 'bg-gray-800/70 border-gray-700/50'}`}>
                <header className="flex justify-between items-center mb-6"><h2 className="text-xl font-bold text-[var(--primary-dark)] dark:text-white">Email Forensics Dashboard</h2><button onClick={() => setTheme(t => t === 'light' ? 'dark' : 'light')} className={`p-2 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 transition-all ${theme === 'light' ? 'bg-gray-200 hover:bg-gray-300 focus:ring-[var(--primary)]' : 'bg-gray-700 hover:bg-gray-600 focus:ring-blue-400'}`}>{theme === 'light' ? '🌙' : '☀️'}</button></header>
                <textarea value={header} onChange={(e) => setHeader(e.target.value)} placeholder="Paste your full email header here..." className="w-full h-48 p-3 rounded-lg border-2 border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-900 focus:border-[var(--primary)] focus:ring-2 focus:ring-[var(--primary-light)] dark:focus:ring-blue-900/50 transition-colors font-mono text-xs"/>
                <div className="mt-4 flex justify-end gap-4"><button onClick={() => { setHeader(''); setAnalysis(null); }} className="text-sm font-semibold text-gray-600 dark:text-gray-300 hover:underline disabled:opacity-50" disabled={isLoading}>Clear</button><button onClick={parseHeader} className="btn bg-[var(--primary)] hover:bg-[var(--primary-dark)] text-white px-6 py-2 flex items-center gap-2 disabled:opacity-50" disabled={isLoading}>{isLoading && <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full spinner"></div>}Analyze</button></div>
                
                {isLoading && <div className="text-center py-12"><div className="w-8 h-8 border-4 border-[var(--primary)] border-t-transparent rounded-full spinner mx-auto"></div><p className="mt-4 font-semibold">Analyzing Header...</p></div>}
                {!analysis && !isLoading && 
                    <div className="text-center py-12 fade-in">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className="mx-auto text-gray-300 dark:text-gray-600"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                        <p className="mt-4 font-semibold text-gray-600 dark:text-gray-400">Your analysis will appear here.</p>
                        <p className="text-sm text-gray-400 dark:text-gray-500">Need help? <a href="#how-to-guide" className="text-[var(--primary)] hover:underline">See our guide</a> on how to find email headers.</p>
                    </div>
                }
                {analysis && !isLoading && <div className="mt-8 fade-in">
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div className="lg:col-span-1 flex flex-col items-center justify-center bg-gray-50 dark:bg-gray-900/50 p-6 rounded-lg subtle-pop">
                           <ScoreGauge score={analysis.score} />
                           <div className="mt-4 text-center">
                               {analysis.totalTime !== null && <p className="text-sm text-gray-500 dark:text-gray-400">Total Delivery Time: <span className="font-bold text-black dark:text-white">{analysis.totalTime.toFixed(2)}s</span></p>}
                           </div>
                        </div>
                        <div className="lg:col-span-2 space-y-4">
                            <div className="bg-white/50 dark:bg-black/20 rounded-lg p-4 subtle-pop" style={{animationDelay: '100ms'}}>
                                <h3 className="font-bold text-lg mb-3 flex items-center gap-2">🚨 <span className="text-[var(--primary-dark)] dark:text-blue-300">Security Summary</span></h3>
                                {analysis.flags.length > 0 ? <div className="space-y-3 text-sm">
                                    {analysis.flags.map((flag, i) => <div key={i}><p className={`font-bold ${flag.level === 'critical' ? 'text-red-600 dark:text-red-400' : flag.level === 'warn' ? 'text-yellow-600 dark:text-yellow-400' : 'text-blue-500 dark:text-blue-400'}`}>{flag.text}</p><p className="text-xs text-gray-600 dark:text-gray-400">{flag.advice}</p></div>)}
                                </div> : <p className="text-sm font-medium text-green-600 dark:text-green-400">✓ No major security red flags detected.</p>}
                            </div>
                             <div className="bg-white/50 dark:bg-black/20 rounded-lg p-4 subtle-pop" style={{animationDelay: '200ms'}}>
                                <h3 className="font-bold text-lg mb-3 flex items-center gap-2">🛡️ <span className="text-[var(--primary-dark)] dark:text-blue-300">Authentication</span></h3>
                                <div className="flex flex-wrap gap-4 items-center">
                                    <div className="flex items-center gap-2"><span className="font-semibold text-sm">SPF:</span> <AuthPill status={analysis.spf} /></div>
                                    <div className="flex items-center gap-2"><span className="font-semibold text-sm">DKIM:</span> <AuthPill status={analysis.dkim} /></div>
                                    <div className="flex items-center gap-2"><span className="font-semibold text-sm">DMARC:</span> <AuthPill status={analysis.dmarc} /></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div className="mt-6 bg-white/50 dark:bg-black/20 rounded-lg p-4 subtle-pop" style={{animationDelay: '300ms'}}>
                         <h3 className="font-bold text-lg mb-3 flex items-center gap-2">✉️ <span className="text-[var(--primary-dark)] dark:text-blue-300">Email Details</span></h3>
                         <div className="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-2 text-sm break-words">
                            <div><strong className="text-gray-500 dark:text-gray-400">From:</strong> <span className="font-mono">{analysis.from || 'N/A'}</span></div>
                            <div><strong className="text-gray-500 dark:text-gray-400">To:</strong> <span className="font-mono">{analysis.to || 'N/A'}</span></div>
                            <div className="sm:col-span-2"><strong className="text-gray-500 dark:text-gray-400">Subject:</strong> {analysis.subject || 'N/A'}</div>
                         </div>
                    </div>
                    <div className="mt-6 bg-white/50 dark:bg-black/20 rounded-lg p-4 subtle-pop" style={{animationDelay: '400ms'}}>
                        <h3 className="font-bold text-lg mb-4 flex items-center gap-2">🗺️ <span className="text-[var(--primary-dark)] dark:text-blue-300">Message Path</span></h3>
                        <div className="space-y-4 text-xs">
                             {pathWithGeo.map((hop, index) => (
                                <div key={hop.id} className="border-l-2 border-dashed border-gray-300 dark:border-gray-600 pl-6 relative">
                                    <div className={`absolute -left-[9px] top-1 w-4 h-4 rounded-full border-2 border-white dark:border-gray-800 ${index === 0 ? 'bg-green-500' : 'bg-gray-400'}`} title={index === 0 ? 'Origin Server' : `Hop ${index + 1}`}></div>
                                    <p className="font-bold text-sm text-gray-800 dark:text-gray-200">{index === 0 ? 'Origin' : `Hop ${index + 1}`}</p>
                                    <p><strong className="text-gray-500 dark:text-gray-400">Server:</strong> <span className="font-mono">{hop.from}</span></p>
                                    <p className="flex items-center gap-2"><strong className="text-gray-500 dark:text-gray-400">IP:</strong> 
                                        <span className="font-mono font-bold text-[var(--primary-dark)] dark:text-blue-300">{hop.ip || 'N/A'}</span>
                                        {hop.loading && <div className="w-3 h-3 border-2 border-gray-400 border-t-transparent rounded-full spinner"></div>}
                                        {hop.geo && <span className="flex items-center gap-1.5 text-gray-600 dark:text-gray-300">{hop.flag && <img src={hop.flag} alt="country flag"/>} {hop.geo}</span>}
                                    </p>
                                </div>
                             ))}
                         </div>
                    </div>
                </div>}
            </div>
        );
    };
    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>

